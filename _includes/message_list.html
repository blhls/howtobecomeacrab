{% assign mailbox = page.mailbox | default: "" %}
{% assign section = page.section | default: "all" %}
{% assign current = page.url %}

<div class="list-header">
  {% if page.list_title %}{{ page.list_title }}{% else %}messages{% endif %}
</div>

{% if mailbox == "drafts" or mailbox == "junk" or mailbox == "account" %}
  {% assign msgs = site.data.messages[mailbox] | default: empty %}
  {% if msgs == empty %}
    <div class="msg">
      <div class="subj">empty</div>
      <div class="meta">no items defined</div>
    </div>
  {% else %}
    {% for m in msgs %}
      {% assign target = m.url %}
      {% assign active = "" %}
      {% if target == current %}
        {% assign active = " active" %}
      {% endif %}

      <a class="msg{{ active }}" href="{% if mailbox == 'account' and m.url == '/' %}{{ site.baseurl }}/{% else %}{{ site.baseurl }}{{ m.url }}{% endif %}">
        <div class="subj">{{ m.subject }}</div>
        <div class="meta">from: {{ m.from }} 路 to: {{ m.to }} 路 {{ m.date }}</div>
      </a>
    {% endfor %}
  {% endif %}
{% else %}
  {% if section == "all" %}
    {% assign posts = site.posts %}
  {% else %}
    {% assign posts = site.posts | where: "section", section %}
  {% endif %}

  {% if posts == empty %}
    <div class="msg">
      <div class="subj">no messages in this folder</div>
      <div class="meta">create a post with section: {{ section }}</div>
    </div>
  {% else %}
    {% for post in posts %}
      {% assign active = "" %}
      {% if post.url == current %}
        {% assign active = " active" %}
      {% endif %}

      <a class="msg{{ active }}" href="{{ site.baseurl }}{{ post.url }}">
        <div class="subj">{{ post.subject | default: post.title }}</div>
        <div class="meta">from: {{ post.from | default: post.section | default: "UNKNOWN" }} 路 to: YOU 路 {{ post.date | date: "%d/%m/%Y" }}</div>
      </a>
    {% endfor %}
  {% endif %}
{% endif %}

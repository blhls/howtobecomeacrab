{% assign mailbox = page.mailbox | default: "" %}
{% assign section = page.section | default: "all" %}

<div class="list-header">
  {% if page.list_title %}{{ page.list_title }}{% else %}messages{% endif %}
</div>

{% if mailbox == "drafts" %}
  {% assign msgs = site.data.messages.drafts | default: empty %}
  {% if msgs == empty %}
    <div class="msg">
      <div class="subj">no drafts</div>
      <div class="meta">add drafts in _data/messages.yml</div>
    </div>
  {% else %}
    {% for m in msgs %}
      <a class="msg" href="{{ site.baseurl }}{{ m.url }}">
        <div class="subj">{{ m.subject }}</div>
        <div class="meta">from: {{ m.from }} 路 to: {{ m.to }} 路 {{ m.date }}</div>
      </a>
    {% endfor %}
  {% endif %}
{% else %}
  {% if section == "all" %}
    {% assign posts = site.posts %}
  {% else %}
    {% assign posts = site.posts | where: "section", section %}
  {% endif %}

  {% if posts == empty %}
    <div class="msg">
      <div class="subj">no messages in this folder</div>
      <div class="meta">create a post with section: {{ section }}</div>
    </div>
  {% else %}
    {% for post in posts %}
      <a class="msg" href="{{ site.baseurl }}{{ post.url }}">
        <div class="subj">{{ post.subject | default: post.title }}</div>
        <div class="meta">from: {{ post.from | default: post.section | default: "UNKNOWN" }} 路 to: YOU 路 {{ post.date | date: "%d/%m/%Y" }}</div>
      </a>
    </a>
    {% endfor %}
  {% endif %}
{% endif %}
